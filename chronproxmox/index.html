<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<meta http-equiv=x-ua-compatible content="IE=edge, chrome=1">
<title>Getting Started MikroTik Cloud Hosted Router (CHR) on Proxmox - Boyang Yan's Tech Blog</title><meta name=description content="This is Boyang Yan's Tech Blog"><meta property="og:title" content="Getting Started MikroTik Cloud Hosted Router (CHR) on Proxmox">
<meta property="og:description" content="Introduction Cloud Hosted Router (CHR) is a RouterOS version intended for running as a virtual machine. It supports the x86 64-bit architecture and can be used on most of the popular hypervisors such as VMWare, Hyper-V, VirtualBox, KVM and others. CHR has full RouterOS features enabled by default but has a different licensing model than other RouterOS versions.
Prerequires  read Cluster/Getting Started Set-up OVS for Proxmox read Cluster/Proxmox PCI Passthrough  System Minimal Requirements  Package version: RouterOS v6.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://yanboyang.com/chronproxmox/"><meta property="og:image" content="https://yanboyang.com/logo.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-12-06T12:28:00+08:00">
<meta property="article:modified_time" content="2021-12-16T09:36:27+00:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://yanboyang.com/logo.png">
<meta name=twitter:title content="Getting Started MikroTik Cloud Hosted Router (CHR) on Proxmox">
<meta name=twitter:description content="Introduction Cloud Hosted Router (CHR) is a RouterOS version intended for running as a virtual machine. It supports the x86 64-bit architecture and can be used on most of the popular hypervisors such as VMWare, Hyper-V, VirtualBox, KVM and others. CHR has full RouterOS features enabled by default but has a different licensing model than other RouterOS versions.
Prerequires  read Cluster/Getting Started Set-up OVS for Proxmox read Cluster/Proxmox PCI Passthrough  System Minimal Requirements  Package version: RouterOS v6.">
<meta name=application-name content="LoveIt">
<meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=https://yanboyang.com/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=https://yanboyang.com/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://yanboyang.com/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=https://yanboyang.com/apple-touch-icon.png><link rel=mask-icon href=https://yanboyang.com/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=https://yanboyang.com/site.webmanifest><link rel=canonical href=https://yanboyang.com/chronproxmox/><link rel=prev href=https://yanboyang.com/clouldinit/><link rel=next href=https://yanboyang.com/proxmoxovs/><link rel=stylesheet href=https://yanboyang.com/lib/normalize/normalize.min.css><link rel=stylesheet href=https://yanboyang.com/css/style.min.css><link rel=stylesheet href=https://yanboyang.com/lib/fontawesome-free/all.min.css><link rel=stylesheet href=https://yanboyang.com/lib/animate/animate.min.css><meta name=baidu-site-verification content="wsCeKMuJ31RLblHf"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Getting Started MikroTik Cloud Hosted Router (CHR) on Proxmox","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yanboyang.com\/chronproxmox\/"},"genre":"posts","keywords":"MikroTik, CHR, Proxmox","wordcount":1357,"url":"https:\/\/yanboyang.com\/chronproxmox\/","datePublished":"2021-12-06T12:28:00+08:00","dateModified":"2021-12-16T09:36:27+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Boyang Yan"},"description":""}</script></head>
<body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-101949995-1','auto'),ga('send','pageview'))</script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-101949995-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<div class=header-wrapper>
<div class=header-title>
<a href=https://yanboyang.com/ title="Boyang Yan's Tech Blog"></a>
</div>
<div class=menu>
<div class=menu-inner><a class=menu-item href=https://yanboyang.com/> Home </a><a class=menu-item href=https://yanboyang.com/posts/> Posts </a><a class=menu-item href=https://yanboyang.com/tags/> Tags </a><a class=menu-item href=https://yanboyang.com/categories/> Categories </a><a class=menu-item href=https://yanboyang.com/about/> About Me </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-desktop>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a>
</div>
</div>
</div>
</header><header class=mobile id=header-mobile>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-101949995-1','auto'),ga('send','pageview'))</script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-101949995-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=https://yanboyang.com/ title="Boyang Yan's Tech Blog"></a>
</div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=menu-mobile><div class=search-wrapper>
<div class="search mobile" id=search-mobile>
<input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-mobile>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</div>
<a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>
Cancel
</a>
</div><a class=menu-item href=https://yanboyang.com/ title>Home</a><a class=menu-item href=https://yanboyang.com/posts/ title>Posts</a><a class=menu-item href=https://yanboyang.com/tags/ title>Tags</a><a class=menu-item href=https://yanboyang.com/categories/ title>Categories</a><a class=menu-item href=https://yanboyang.com/about/ title>About Me</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a></div>
</div>
</header>
<div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div>
<main class=main>
<div class=container><div class=toc id=toc-auto>
<h2 class=toc-title>Contents</h2>
<div class=toc-content id=toc-content-auto></div>
</div><article class="page single"><h1 class="single-title animated flipInX">Getting Started MikroTik Cloud Hosted Router (CHR) on Proxmox</h1><div class=post-meta>
<div class=post-meta-line><span class=post-author><a href=https://yanboyang.com/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Boyang Yan</a></span>&nbsp;<span class=post-category>included in <a href=https://yanboyang.com/categories/cluster/><i class="far fa-folder fa-fw"></i>Cluster</a></span></div>
<div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-12-06>2021-12-06</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1357 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;7 minutes&nbsp;</div>
</div><div class="details toc" id=toc-static kept=true>
<div class="details-summary toc-title">
<span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#introduction>Introduction</a></li>
<li><a href=#prerequires>Prerequires</a></li>
<li><a href=#system-minimal-requirements>System Minimal Requirements</a></li>
<li><a href=#the-chr-has-4-license-levels>The CHR has 4 license levels:</a>
<ul>
<li><a href=#paid-licenses>Paid licenses</a>
<ul>
<li><a href=#p1>p1</a></li>
<li><a href=#p10>p10</a></li>
<li><a href=#p-unlimited>p-unlimited</a></li>
<li><a href=#free-licenses>Free licenses</a></li>
</ul>
</li>
</ul>
</li>
<li><a href=#chr-proxmox-installation>CHR ProxMox installation</a>
<ul>
<li><a href=#step-1-registration-a-new-mikrotik-account-if-you-have-not-it-dot>Step 1: Registration a new mikrotik account, if you have NOT it.</a></li>
<li><a href=#step-2-installation>Step 2: Installation</a></li>
<li><a href=#step-3-add-wan-port-to-ros>Step 3: Add WAN port to ROS</a>
<ul>
<li><a href=#list-network-interface-name-with-pci-id>List network interface name with PCI ID</a></li>
<li><a href=#add-wan>Add WAN</a></li>
</ul>
</li>
<li><a href=#step-4-start-your-ros>Step 4: Start your ROS</a></li>
<li><a href=#step-5-disable-api-api-ssl-telnet-ftp-www-and-www-ssl>Step 5: Disable API, API-SSL, Telnet, FTP, WWW and WWW-SSL</a></li>
<li><a href=#step-6-interface-rename>Step 6: interface rename</a></li>
<li><a href=#step-7-add-dhcp-client>Step 7: add dhcp client</a></li>
<li><a href=#step-8-add-dns>Step 8: add DNS</a></li>
<li><a href=#step-9-firwall-nat>Step 9: firwall NAT</a></li>
<li><a href=#step-10-ip-pool>Step 10: IP Pool</a></li>
<li><a href=#step-11-dhcp-server>Step 11: DHCP Server</a></li>
</ul>
</li>
</ul>
</nav></div>
</div><div class=content id=content><h2 id=introduction>Introduction</h2>
<p>Cloud Hosted Router (CHR) is a RouterOS version intended for running as a virtual machine. It supports the x86 64-bit architecture and can be used on most of the popular hypervisors such as VMWare, Hyper-V, VirtualBox, KVM and others. CHR has full RouterOS features enabled by default but has a different licensing model than other RouterOS versions.</p>
<h2 id=prerequires>Prerequires</h2>
<ol>
<li>read <a href=https://yanboyang.com/proxmoxovs/ rel>Cluster/Getting Started Set-up OVS for Proxmox</a></li>
<li>read <a href=https://yanboyang.com/proxmoxpassthrough/ rel>Cluster/Proxmox PCI Passthrough</a></li>
</ol>
<h2 id=system-minimal-requirements>System Minimal Requirements</h2>
<ul>
<li>Package version: RouterOS v6.34 or newer</li>
<li>Host CPU: 64-bit with virtualization support</li>
<li>RAM: 128MB or more</li>
<li>Disk: 128MB disk space for the CHR virtual hard drive (Max: 16GB)</li>
</ul>
<p><strong>NOTE</strong>: The minimum required RAM depends on interface count and CPU count. You can get an approximate number by using the following formula: RAM = 128 + [ 8 × (CPU_COUNT) × (INTERFACE_COUNT - 1) ]</p>
<h2 id=the-chr-has-4-license-levels>The CHR has 4 license levels:</h2>
<ul>
<li>free</li>
<li><strong>p1</strong> perpetual-1 ($45)</li>
<li><strong>p10</strong> perpetual-10 ($95)</li>
<li><strong>p-unlimited</strong> perpetual-unlimited ($250)</li>
</ul>
<p>Perpetual is a lifetime license (buy once, use forever). It is possible to transfer a perpetual license to another CHR instance. A running CHR instance will indicate the time when it has to access the account server to renew it&rsquo;s license. If the CHR instance will not be able to renew the license it will behave as if the trial period has ran out and will not allow an upgrade of RouterOS to a newer version.</p>
<p>After licensing a running trial system, you must manually run the <strong>/system license renew</strong> function from the CHR to make it active. Otherwise the system will not know you have licensed it in your account. If you do not do this before the system deadline time, the trial will end and you will have to do a complete fresh CHR installation, request a new trial and then license it with the license you had obtained.</p>
<h3 id=paid-licenses>Paid licenses</h3>
<h4 id=p1>p1</h4>
<p>p1 (perpetual-1) license level allows CHR to run indefinitely. It is limited to 1Gbps upload per interface. All the rest of the features provided by CHR are available without restrictions. It is possible to upgrade p1 to p10 or p-unlimited After the upgrade is purchased the former license will become available for later use on your account.</p>
<h4 id=p10>p10</h4>
<p>p10 (perpetual-10) license level allows CHR to run indefinitely. It is limited to 10Gbps upload per interface. All the rest of the features provided by CHR are available without restrictions. It is possible to upgrade p10 to p-unlimited After the upgrade is purchased the former license will become available for later use on your account.</p>
<h4 id=p-unlimited>p-unlimited</h4>
<p>The p-unlimited (perpetual-unlimited) license level allows CHR to run indefinitely. It is the highest tier license and it has no enforced limitations.</p>
<h4 id=free-licenses>Free licenses</h4>
<p>The free license level allows CHR to run indefinitely. It is limited to 1Mbps upload per interface. All the rest of the features provided by CHR are available without restrictions. To use this, all you have to do is download disk image file from our download page and create a virtual guest.</p>
<h2 id=chr-proxmox-installation>CHR ProxMox installation</h2>
<h3 id=step-1-registration-a-new-mikrotik-account-if-you-have-not-it-dot>Step 1: Registration a new mikrotik account, if you have NOT it.</h3>
<p><a href=https://mikrotik.com/client target=_blank rel="noopener noreferrer">https://mikrotik.com/client</a></p>
<h3 id=step-2-installation>Step 2: Installation</h3>
<p>I recommand using the below Bash script to install. You need to <strong>ssh</strong> into your ProxMox and run below script.</p>
<p>Before run this script, Please do some research, which version of ROS you want to install. Please, check this <a href=https://mikrotik.com/download target=_blank rel="noopener noreferrer">link</a>.</p>
<p>What this script does:</p>
<ul>
<li>Stores tmp files in: /root/temp dir.</li>
<li>Downloads raw image archive from MikroTik download page.</li>
<li>Converts image file to qcow format.</li>
<li>Creates basic VM that is attached to MGMT bridge.</li>
</ul>
<p><strong>Important Note</strong>:</p>
<ol>
<li>Make sure you have a MGMT bridge, which named <strong>vmbr0</strong>. If you have NOT avaiable bridge, please have a look <a href=https://yanboyang.com/proxmoxovs/ rel>Cluster/Getting Started Set-up OVS for Proxmox</a></li>
<li>If your network card is Intel i211, Please install RouterOS 7, not RouterOS 6. RouterOS 6 does NOT support i211 network card.</li>
</ol>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=cp>#!/bin/bash
</span><span class=cp></span>
<span class=c1>#vars</span>
<span class=nv>version</span><span class=o>=</span><span class=s2>&#34;nil&#34;</span>
<span class=nv>vmID</span><span class=o>=</span><span class=s2>&#34;nil&#34;</span>

<span class=nb>echo</span> <span class=s2>&#34;############## Start of Script ##############
</span><span class=s2>
</span><span class=s2>## Checking if temp dir is available...&#34;</span>
<span class=k>if</span> <span class=o>[</span> -d /root/temp <span class=o>]</span>
<span class=k>then</span>
    <span class=nb>echo</span> <span class=s2>&#34;-- Directory exists!&#34;</span>
<span class=k>else</span>
    <span class=nb>echo</span> <span class=s2>&#34;-- Creating temp dir!&#34;</span>
    mkdir /root/temp
<span class=k>fi</span>

<span class=c1># apt install unzip</span>
<span class=nb>echo</span> <span class=s2>&#34;Install unzip&#34;</span>
apt update
apt install unzip -y

<span class=c1># Ask user for version</span>
<span class=nb>echo</span> <span class=s2>&#34;## Preparing for image download and VM creation!&#34;</span>
<span class=nb>read</span> -p <span class=s2>&#34;Please input CHR version to deploy ( 6.49.1 (Stable) 6.49rc2 (Testing) 7.1 (Testing)):&#34;</span> version
<span class=c1># Check if image is available and download if needed</span>
<span class=k>if</span> <span class=o>[</span> -f /root/temp/chr-<span class=nv>$version</span>.img <span class=o>]</span>
<span class=k>then</span>
    <span class=nb>echo</span> <span class=s2>&#34;-- CHR image is available.&#34;</span>
<span class=k>else</span>
    <span class=nb>echo</span> <span class=s2>&#34;-- Downloading CHR </span><span class=nv>$version</span><span class=s2> image file.&#34;</span>
    <span class=nb>cd</span>  /root/temp
    <span class=nb>echo</span> <span class=s2>&#34;---------------------------------------------------------------------------&#34;</span>
    wget https://download.mikrotik.com/routeros/<span class=nv>$version</span>/chr-<span class=nv>$version</span>.img.zip
    unzip chr-<span class=nv>$version</span>.img.zip
    <span class=nb>echo</span> <span class=s2>&#34;---------------------------------------------------------------------------&#34;</span>
<span class=k>fi</span>
<span class=c1># List already existing VM&#39;s and ask for vmID</span>
<span class=nb>echo</span> <span class=s2>&#34;== Printing list of VM&#39;s on this hypervisor!&#34;</span>
qm list
<span class=nb>echo</span> <span class=s2>&#34;&#34;</span>
<span class=nb>read</span> -p <span class=s2>&#34;Please Enter free vm ID to use:&#34;</span> vmID
<span class=nb>echo</span> <span class=s2>&#34;&#34;</span>
<span class=c1># Create storage dir for VM if needed.</span>
<span class=k>if</span> <span class=o>[</span> -d /var/lib/vz/images/<span class=nv>$vmID</span> <span class=o>]</span>
<span class=k>then</span>
    <span class=nb>echo</span> <span class=s2>&#34;-- VM Directory exists! Ideally try another vm ID!&#34;</span>
    <span class=nb>read</span> -p <span class=s2>&#34;Please Enter free vm ID to use:&#34;</span> vmID
<span class=k>else</span>
    <span class=nb>echo</span> <span class=s2>&#34;-- Creating VM image dir!&#34;</span>
    mkdir /var/lib/vz/images/<span class=nv>$vmID</span>
<span class=k>fi</span>

<span class=c1># Resize image</span>
qemu-img resize /root/temp/chr-<span class=nv>$version</span>.img +10G

<span class=c1># Creating VM</span>
<span class=nb>echo</span> <span class=s2>&#34;-- Creating new CHR VM&#34;</span>
qm create <span class=nv>$vmID</span> <span class=se>\
</span><span class=se></span>  --name chr-<span class=nv>$version</span> <span class=se>\
</span><span class=se></span>  --net0 virtio,bridge<span class=o>=</span>vmbr0 <span class=se>\
</span><span class=se></span>  --bootdisk virtio0 <span class=se>\
</span><span class=se></span>  --ostype l26 <span class=se>\
</span><span class=se></span>  --memory <span class=m>256</span> <span class=se>\
</span><span class=se></span>  --onboot no <span class=se>\
</span><span class=se></span>  --sockets <span class=m>1</span> <span class=se>\
</span><span class=se></span>  --cores <span class=m>1</span> <span class=se>\
</span><span class=se></span>  --virtio0 local-lvm:vm-<span class=nv>$vmID</span>-disk-0

<span class=c1># import image</span>
<span class=nb>echo</span> <span class=s2>&#34;-- Import RAW image to local-lvm&#34;</span>
qm importdisk <span class=nv>$vmID</span> /root/temp/chr-<span class=nv>$version</span>.img local-lvm

<span class=c1># remove downloaded raw image and zip</span>
rm /root/temp/chr-<span class=nv>$version</span>.img.zip
rm /root/temp/chr-<span class=nv>$version</span>.img

<span class=nb>echo</span> <span class=s2>&#34;############## End of Script ##############&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>NOTE</strong>: ERROR: storage &lsquo;local&rsquo; does not support content-type &lsquo;images&rsquo;
<strong>NOTE</strong>: Useful snippet to clean up the BASH script from Windows formatting that may interfere with script if it&rsquo;s edited on a Windows workstation:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=go>sed -i -e &#39;s/\r$//&#39; *.sh
</span></code></pre></td></tr></table>
</div>
</div><h3 id=step-3-add-wan-port-to-ros>Step 3: Add WAN port to ROS</h3>
<p>I am add a passthrough NIC as WAM, so before you read this section. Please, read <a href=https://yanboyang.com/proxmoxpassthrough/ rel>Cluster/Proxmox PCI Passthrough</a> first.</p>
<p>When you <strong>DONE</strong> set-up passthrough, now lets we list network interfaces name with PCI ID and add WAN.</p>
<h4 id=list-network-interface-name-with-pci-id>List network interface name with PCI ID</h4>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>apt install lshw
lshw -class network
</code></pre></td></tr></table>
</div>
</div><p>For example, you can found interface name with bus id at below.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>*-network
       description: Ethernet interface
       product: I211 Gigabit Network Connection
       vendor: Intel Corporation
       physical id: 0
       bus info: pci@0000:06:00.0
       logical name: enp6s0
       version: 03
       serial: 00:90:27:e5:8d:09
       capacity: 1Gbit/s
       width: 32 bits
       clock: 33MHz
       capabilities: pm msi msix pciexpress bus_master cap_list ethernet physical tp 10bt 10bt-fd 100bt 100bt-fd 1000bt-fd autonegotiation
       configuration: autonegotiation=on broadcast=yes driver=igb driverversion=5.13.19-2-pve firmware=0. 6-1 latency=0 link=no multicast=yes port=twisted pair
       resources: irq:17 memory:df000000-df01ffff ioport:9000(size=32) memory:df020000-df023fff
</code></pre></td></tr></table>
</div>
</div><h4 id=add-wan>Add WAN</h4>
<p>now lets we add WAN to ROS.</p>
<p>Go to <strong>Hardware</strong> Section -> <strong>Add</strong> -> <strong>PCI Device</strong></p>
<p>Choose your WAN need to add in.</p>
<figure><img src=https://res.cloudinary.com/dkvj6mo4c/image/upload/v1638780489/PVE/hardwareAdd%5Faqh8vq.png>
</figure>
<h3 id=step-4-start-your-ros>Step 4: Start your ROS</h3>
<p>check interface name:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>interface print
</code></pre></td></tr></table>
</div>
</div><p>check IP address:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ip <span class=nb>export</span>
</code></pre></td></tr></table>
</div>
</div><p>remove IP address</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ip address remove IDnum
</code></pre></td></tr></table>
</div>
</div><p>Assign IP address:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ip address add <span class=nv>address</span><span class=o>=</span>192.168.1.253/24 <span class=nv>interface</span><span class=o>=</span>ether2
</code></pre></td></tr></table>
</div>
</div><h3 id=step-5-disable-api-api-ssl-telnet-ftp-www-and-www-ssl>Step 5: Disable API, API-SSL, Telnet, FTP, WWW and WWW-SSL</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ip service disable api,api-ssl,ftp,ssh,telnet,www,www-ssl
</code></pre></td></tr></table>
</div>
</div><h3 id=step-6-interface-rename>Step 6: interface rename</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>interface <span class=nb>set</span> ether2 <span class=nv>name</span><span class=o>=</span><span class=s2>&#34;LAN&#34;</span>
interface <span class=nb>set</span> ether1 <span class=nv>name</span><span class=o>=</span><span class=s2>&#34;WAN&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=step-7-add-dhcp-client>Step 7: add dhcp client</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ip dhcp-client print detail

ip dhcp-client <span class=nb>set</span> <span class=nv>interface</span><span class=o>=</span>WAN <span class=nv>disable</span><span class=o>=</span>no use-peer-dns<span class=o>=</span>no

ip dhcp-client print detail
</code></pre></td></tr></table>
</div>
</div><h3 id=step-8-add-dns>Step 8: add DNS</h3>
<p><a href=https://wiki.mikrotik.com/wiki/Manual:IP/DNS target=_blank rel="noopener noreferrer">https://wiki.mikrotik.com/wiki/Manual:IP/DNS</a></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ip dns <span class=nb>set</span> <span class=nv>servers</span><span class=o>=</span>192.168.1.252 max-udp-packet-size<span class=o>=</span><span class=m>8192</span>
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ip dns static add <span class=nv>name</span><span class=o>=</span>ros <span class=nv>address</span><span class=o>=</span>192.168.1.253
</code></pre></td></tr></table>
</div>
</div><h3 id=step-9-firwall-nat>Step 9: firwall NAT</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ip firewall nat add <span class=nv>chain</span><span class=o>=</span>srcnat <span class=nv>action</span><span class=o>=</span>masquerade
</code></pre></td></tr></table>
</div>
</div><h3 id=step-10-ip-pool>Step 10: IP Pool</h3>
<p><a href=https://wiki.mikrotik.com/wiki/Manual:IP/Pools target=_blank rel="noopener noreferrer">https://wiki.mikrotik.com/wiki/Manual:IP/Pools</a></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ip pool add <span class=nv>name</span><span class=o>=</span>ip-pool <span class=nv>ranges</span><span class=o>=</span>192.168.1.100-192.168.1.200
</code></pre></td></tr></table>
</div>
</div><h3 id=step-11-dhcp-server>Step 11: DHCP Server</h3>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ip dhcp-server add <span class=nv>name</span><span class=o>=</span>LANDHCP <span class=nv>interface</span><span class=o>=</span>LAN address-pool<span class=o>=</span>ip-p
ool
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>ip dhcp-server network add <span class=nv>address</span><span class=o>=</span>192.168.1.0/24 <span class=nv>gateway</span><span class=o>=</span>192.1
68.1.252
</code></pre></td></tr></table>
</div>
</div></div><div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span>Updated on 2021-12-16</span>
</div>
<div class=post-info-license></div>
</div>
<div class=post-info-line>
<div class=post-info-md><span>
<a class=link-to-markdown href=https://yanboyang.com/chronproxmox/index.md target=_blank rel="noopener noreferrer">Read Markdown</a>
</span></div>
<div class=post-info-share>
<span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://yanboyang.com/chronproxmox/ data-title="Getting Started MikroTik Cloud Hosted Router (CHR) on Proxmox" data-hashtags=MikroTik,CHR,Proxmox><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://yanboyang.com/chronproxmox/ data-hashtag=MikroTik><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://yanboyang.com/chronproxmox/ data-title="Getting Started MikroTik Cloud Hosted Router (CHR) on Proxmox" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://yanboyang.com/chronproxmox/ data-title="Getting Started MikroTik Cloud Hosted Router (CHR) on Proxmox"><i data-svg-src=https://yanboyang.com/lib/simple-icons/icons/line.min.svg></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://yanboyang.com/chronproxmox/ data-title="Getting Started MikroTik Cloud Hosted Router (CHR) on Proxmox"><i class="fab fa-weibo fa-fw"></i></a><a href=javascript:void(0); title="Share on Myspace" data-sharer=myspace data-url=https://yanboyang.com/chronproxmox/ data-title="Getting Started MikroTik Cloud Hosted Router (CHR) on Proxmox" data-description><i data-svg-src=https://yanboyang.com/lib/simple-icons/icons/myspace.min.svg></i></a><a href=javascript:void(0); title="Share on Blogger" data-sharer=blogger data-url=https://yanboyang.com/chronproxmox/ data-title="Getting Started MikroTik Cloud Hosted Router (CHR) on Proxmox" data-description><i class="fab fa-blogger fa-fw"></i></a><a href=javascript:void(0); title="Share on Evernote" data-sharer=evernote data-url=https://yanboyang.com/chronproxmox/ data-title="Getting Started MikroTik Cloud Hosted Router (CHR) on Proxmox"><i class="fab fa-evernote fa-fw"></i></a></span>
</div>
</div>
</div>
<div class=post-info-more>
<section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=https://yanboyang.com/tags/mikrotik/>MikroTik</a>,&nbsp;<a href=https://yanboyang.com/tags/chr/>CHR</a>,&nbsp;<a href=https://yanboyang.com/tags/proxmox/>Proxmox</a></section>
<section>
<span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=https://yanboyang.com/>Home</a></span>
</section>
</div>
<div class=post-nav><a href=https://yanboyang.com/clouldinit/ class=prev rel=prev title="Create Proxmox cloud-init template :cloud-init:Proxmox:"><i class="fas fa-angle-left fa-fw"></i>Create Proxmox cloud-init template :cloud-init:Proxmox:</a>
<a href=https://yanboyang.com/proxmoxovs/ class=next rel=next title="Getting Started Set-up OVS for Proxmox">Getting Started Set-up OVS for Proxmox<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id=comments><div id=disqus_thread class=comment></div><noscript>
Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.
</noscript></div></article></div>
</main><footer class=footer>
<div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer" title="Hugo 0.90.1">Hugo</a> | Theme - <a href=https://github.com/sunt-programator/CodeIT target=_blank rel="noopener noreferrer" title="CodeIT 0.2.10"><i class="fas fa-laptop-code fa-fw"></i> CodeIT</a>
</div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://yanboyang.com/ target=_blank rel="noopener noreferrer">Boyang Yan</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div>
</div>
</footer></div>
<div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top">
<i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments">
<i class="fas fa-comment fa-fw"></i>
</a>
</div><link rel=stylesheet href=https://yanboyang.com/lib/katex/katex.min.css><link rel=stylesheet href=https://yanboyang.com/lib/katex/copy-tex.min.css><link rel=stylesheet href=https://yanboyang.com/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=https://boyang-blog.disqus.com/embed.js defer></script><script type=text/javascript src=https://yanboyang.com/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=https://yanboyang.com/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=https://yanboyang.com/lib/lunr/lunr.min.js></script><script type=text/javascript src=https://yanboyang.com/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=https://yanboyang.com/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=https://yanboyang.com/lib/sharer/sharer.min.js></script><script type=text/javascript src=https://yanboyang.com/lib/katex/katex.min.js></script><script type=text/javascript src=https://yanboyang.com/lib/katex/auto-render.min.js></script><script type=text/javascript src=https://yanboyang.com/lib/katex/copy-tex.min.js></script><script type=text/javascript src=https://yanboyang.com/lib/katex/mhchem.min.js></script><script type=text/javascript src=https://yanboyang.com/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:1e3},comment:{},cookieconsent:{content:{dismiss:"Got it!",link:"Learn more",message:"This website uses Cookies to improve your experience."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=https://yanboyang.com/js/theme.min.js></script></body>
</html>